---
title: QuLab 2.0 Merge Plan
date: 2025-10-30
---

## 1. Goal

The primary goal of this merge is to integrate the `QuLabSimulator` from the legacy `qulab_api.py` into the modern `ingest` and `validation` framework of QuLabInfinite. This will allow us to treat QuLab 2.0 simulation results as a data source that can be ingested, validated, and stored alongside experimental and other computational data.

## 2. Key Components

- **`api/qulab_api.py`**: Contains the `QuLabSimulator`, a high-level fa√ßade for running various simulations (materials, environmental, physics).
- **`ingest/sources/qulab2.py`**: A new data source client responsible for running `QuLabSimulator` experiments and converting the results into canonical `Record` objects.
- **`ingest/pipeline.py`**: The ingestion pipeline that will process records generated by the `qulab2.py` client.
- **`validation/`**: The validation framework. We will add reference data for simulations to validate the simulator's output.

## 3. Merge Strategy

### Step 1: Refactor `QuLabSimulator` for Broader Use

The `QuLabSimulator` is currently a monolithic class. We will break it down into smaller, more focused components.

- **Configuration Management**: Externalize simulation parameters into a `config.yaml` file. This will make it easier to manage different simulation setups.
- **Result Serialization**: Ensure that `ExperimentResult` objects can be reliably serialized to JSON. We will add a `to_json` method.

### Step 2: Implement the `ingest/sources/qulab2.py` Client

This new client will be the bridge between the QuLab 2.0 simulator and the QuLabInfinite data pipeline.

- The `load_live` function in `qulab2.py` will take an `ExperimentRequest` as input.
- It will instantiate `QuLabSimulator`, run the experiment, and get an `ExperimentResult`.
- It will then transform the `ExperimentResult` into one or more canonical records (`RecordChem`, `RecordMaterial`, etc.). This will likely involve mapping fields and adding appropriate provenance information.

### Step 3: Integrate into the Ingestion Pipeline

- A new CLI command in `ingest/cli.py` will be added to trigger QuLab 2.0 simulations. For example: `python -m ingest.cli qulab2 --spec-file qulab_experiment.json --output-path data/raw/qulab2_results.jsonl`.
- The `qulab_experiment.json` file will contain the `ExperimentRequest` details.
- The pipeline will run the simulation, generate records, validate them, and save them to the specified output path.

### Step 4: Add Validation for Simulation Results

- We will add new entries to `validation/reference_data.json` that correspond to known outcomes of QuLab 2.0 simulations. For example, the yield strength of "SS 304" from a simulated tensile test.
- The `validation/run_validation.py` script will be updated to recognize these new reference keys and extract the corresponding values from the ingested simulation records.

## 4. Timeline

- **Week 1**: Refactor `QuLabSimulator` and implement the basic `ingest/sources/qulab2.py` client.
- **Week 2**: Integrate with the ingestion pipeline and CLI.
- **Week 3**: Add validation rules and reference data.
- **Week 4**: Thorough testing and documentation.

This plan provides a clear path to integrating the valuable simulation capabilities of QuLab 2.0 into the robust data handling framework of QuLabInfinite, creating a more powerful and unified platform for scientific research.

